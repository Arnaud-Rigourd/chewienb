<h1>Dashboard</h1>

<div class="dashboard-container container">
  <div class="my-bookings">
    <h2>Reservations en cours</h2>
    <ul>
      <% @bookings_current_user.sort_by{ |b| b.created_at }.reverse!.each do |b| %>
        <% if (b.start_date && b.end_date).present? %>
          <% if Date.today <= b.start_date %>
            <% if b.offer.photo.attached? %>
            <li><%= link_to (cl_image_tag b.offer.photo.key, height: 200, width: 300), offer_path(b.offer) %></li>
          <% else %>
            <li><%= link_to (image_tag "#{b.offer.photo_url}"), offer_path(b.offer) %></li>
          <% end %>
            <li><%= link_to b.offer.title, offer_path(b.offer) %></li>
            <li>From: <%= b.start_date %></li>
            <li>To: <%= b.end_date %></li>
            <li>Status : <%= b.status %></li>
            <% if b.status == "pending" %>
              <span><%= link_to 'Cancel my booking', booking_path(b), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to cancel your booking?" } %></span>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    </ul>
  </div>

  <div class="my-bookings">
    <h2>Reservations à valider</h2>
    <ul>
      <% @bookinks_waiting_for_validation_sorted.each do |b| %>
        <% if b.status == "pending" %>
          <% if b.offer.photo.attached? %>
            <li><%= link_to (cl_image_tag b.offer.photo.key, height: 200, width: 300), offer_path(b.offer) %></li>
          <% else %>
            <li><%= link_to (image_tag "#{b.offer.photo_url}"), offer_path(b.offer) %></li>
          <% end %>
          <li><%= link_to b.offer.title, offer_path(b.offer) %></li>
          <li><%= b.offer.price %></li>
          <li>Dates demandés : du <%= b.start_date %> au <%= b.end_date %></li>
          <span><%= link_to "valider", booking_path(b), data: { turbo_method: :patch } %></span>
          <span><%= link_to "supprimer", booking_path(b), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %></span>
        <% end %>
      <% end %>
    </ul>
  </div>

  <div class="my-bookings">
    <h2>Reservations validées</h2>
    <ul>
      <% @bookinks_waiting_for_validation_sorted.each do |b| %>
        <% if b.status == "validated" %>
          <% if b.offer.photo.attached? %>
            <li><%= link_to (cl_image_tag b.offer.photo.key, height: 200, width: 300), offer_path(b.offer) %></li>
          <% else %>
            <li><%= link_to (image_tag "#{b.offer.photo_url})"), offer_path(b.offer) %></li>
          <% end %>
          <li><%= link_to b.offer.title, offer_path(b.offer) %></li>
          <li><%= b.offer.price %></li>
          <li>Dates demandés : du <%= b.start_date %> au <%= b.end_date %></li>
        <% end %>
      <% end %>
    </ul>
  </div>

  <div class="my-bookings">
    <h2>Mes offres publiées</h2>
    <ul>
      <% @offers_current_user.each do |o| %>
          <% if o.photo.attached? %>
              <li><%= link_to (cl_image_tag o.photo.key, height: 200, width: 300), offer_path(o) %></li>
            <% else %>
              <li><%= link_to (image_tag "#{o.photo_url}"), offer_path(o) %></li>
            <% end %>
          <li><%= link_to o.title, offer_path(o) %></li>
          <li><%= o.description %></li>
      <% end %>
    </ul>
  </div>

  <div class="my-bookings">
    <h4>anciennes réservations</h4>
    <ul>
      <% @bookings_current_user.each do |b| %>
        <% if (b.start_date && b.end_date).present? %>
          <% if Date.today > b.end_date %>
            <li><%= link_to (image_tag "#{b.offer.photo_url}"), offer_path(b.offer) %></li>
            <%# <img src="https://www.starwars-universe.com/images/encyclopedie/vaisseaux_vehicules/avatars_v6/ST70.png" alt="starship" /> %>
            <li><%= link_to b.offer.title, offer_path(b.offer) %></li>
            <li>depuis le: <%= b.start_date %></li>
            <li>jusqu'au: <%= b.end_date %></li>

          <% end %>
        <% end %>
      <% end %>
    </ul>
  </div>

  <p><%= link_to "Back to starships", offers_path %></p>
</div>
